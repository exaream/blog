<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="PostgreSQL Basic"><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="PostgreSQL Basic"><meta property="og:description" content="PostgreSQL Basic"><meta property="og:type" content="article"><meta property="og:url" content="https://exaream.dev/postgresql/basic/"><meta property="article:section" content="postgresql"><meta property="article:published_time" content="2020-01-01T00:00:00+00:00"><meta property="article:modified_time" content="2020-01-01T00:00:00+00:00"><title>PostgreSQL Basic | Tech</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.2b9def0b82f295c61d95e813d7070b9c83cd9011237c3ecb1f095bb48d628476.css integrity="sha256-K53vC4LylcYdlegT1wcLnIPNkBEjfD7LHwlbtI1ihHY=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.0a5de7015abf6749950f1f43e78425c0c0c458d9662ecffa2c8e5fc0e2c1e17a.js integrity="sha256-Cl3nAVq/Z0mVDx9D54QlwMDEWNlmLs/6LI5fwOLB4Xo=" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-W638642WNE"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W638642WNE",{anonymize_ip:!1})}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W638642WNE"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W638642WNE")</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Tech</span></a></h2><h3 id=menu>Menu
<a class=anchor href=#menu>#</a></h3><ul><li><strong><a href=https://exaream.dev/git/>Git</a></strong><ul><li><a href=https://exaream.dev/git/basic/>Git Basic</a></li><li><a href=https://exaream.dev/git/tool/>Git Tool</a></li></ul></li><li><strong><a href=https://exaream.dev/container/>Container</a></strong><ul><li><a href=https://exaream.dev/container/docker/>Docker</a></li><li><a href=https://exaream.dev/container/docker-compose/>Docker Compose</a></li><li><a href=https://exaream.dev/container/docker-swarm/>Docker Swarm</a></li></ul></li><li><strong><a href=https://exaream.dev/mysql/>MySQL</a></strong><ul><li><a href=https://exaream.dev/mysql/basic/>MySQL Basic</a></li></ul></li><li><strong><a href=https://exaream.dev/mysql/>PostgreSQL</a></strong><ul><li><a href=https://exaream.dev/postgresql/basic/>PostgreSQL Basic</a></li></ul></li><li><strong><a href=https://exaream.dev/go/>Go</a></strong><ul><li><a href=https://exaream.dev/go/check-list/>Go Check List</a></li><li><a href=https://exaream.dev/go/test/>Go Test</a></li><li><a href=https://exaream.dev/go/testscript/>Go TestScript</a></li><li><a href=https://exaream.dev/go/link/>Go Link</a></li></ul></li><li><strong><a href=https://exaream.dev/linux/>Linux</a></strong><ul><li><a href=https://exaream.dev/linux/command/>Linux Command</a></li><li><a href=https://exaream.dev/linux/ubuntu/>Ubuntu</a></li></ul></li><li><strong><a href=https://exaream.dev/python/>Python</a></strong><ul><li><a href=https://exaream.dev/python/basic/>Python Basic</a></li><li><a href=https://exaream.dev/python/ocr/>Python OCR</a></li></ul></li><li><strong><a href=https://exaream.dev/php/>PHP</a></strong><ul><li><a href=https://exaream.dev/php/phpunit/>PHPUnit</a></li><li><a href=https://exaream.dev/php/phpmetrics/>PhpMetrics</a></li><li><a href=https://exaream.dev/php/command-line/>PHP Command Line</a></li></ul></li><li><strong><a href=https://exaream.dev/javascript/>JavaScript</a></strong><ul><li><a href=https://exaream.dev/javascript/nodejs/>Node.js</a></li></ul></li><li><strong><a href=https://exaream.dev/shellscript/>Shellscript</a></strong><ul><li><a href=https://exaream.dev/shellscript/memo/>Shellscript Memo</a></li></ul></li><li><strong><a href=https://exaream.dev/mac/>Mac</a></strong><ul><li><a href=https://exaream.dev/mac/setting/>Mac Setting</a></li><li><a href=https://exaream.dev/mac/iterm2/>iTerm2</a></li></ul></li><li><strong><a href=https://exaream.dev/tool/>Tool</a></strong><ul><li><a href=https://exaream.dev/tool/hugo/>Hugo</a></li><li><a href=https://exaream.dev/tool/jenkins/>Jenkins</a></li><li><a href=https://exaream.dev/tool/vscode/>VS Code</a></li><li><a href=https://exaream.dev/tool/excel/>Excel</a></li><li><a href=https://exaream.dev/tool/mailcatcher/>MailCatcher</a></li></ul></li><li><strong><a href=https://exaream.dev/lang/>Language</a></strong><ul><li><a href=https://exaream.dev/lang/english/>English</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>PostgreSQL Basic</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><h2>Tags</h2><ul class=tags><li><a href=/tags/postgresql>PostgreSQL</a><li><a href=/tags/sql>SQL</a></ul><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#psql-command><code>psql</code> command</a><ul><li><a href=#usage>Usage</a></li><li><a href=#options>Options</a></li></ul></li><li><a href=#commands-using-backslash>Commands using <code>\(backslash)</code></a></li><li><a href=#postgresqls-info>PostgreSQL&rsquo;s Info</a><ul><li><a href=#default-connection-info>Default Connection Info</a></li><li><a href=#table-list>Table List</a></li><li><a href=#column-list>Column List</a></li><li><a href=#process-list>Process List</a></li></ul></li><li><a href=#pg_dump-command><code>pg_dump</code> command</a><ul><li><a href=#show-info-related-create-table-create-trigger>Show info related <code>CREATE TABLE</code>, <code>CREATE TRIGGER</code></a></li><li><a href=#backup-one-db>Backup one DB</a></li><li><a href=#restore>Restore</a></li></ul></li><li><a href=#pg_dumpall-command><code>pg_dumpall</code> command</a><ul><li><a href=#backup-all-dbs>Backup all DBs</a></li></ul></li><li><a href=#explain-execution-plan><code>EXPLAIN</code> (Execution Plan)</a></li><li><a href=#create-table><code>CREATE TABLE</code></a><ul><li><a href=#copy-definitions--create-table>Copy definitions & Create table</a></li><li><a href=#define-id-and-timestamp>Define id and timestamp</a></li></ul></li><li><a href=#timezone>Timezone</a><ul><li><a href=#check-current-timezone>Check current timezone</a></li><li><a href=#check-timezones-that-can-be-set>Check timezones that can be set</a></li><li><a href=#set-new-timezone>Set new timezone</a></li><li><a href=#apply-the-change>Apply the change</a></li></ul></li><li><a href=#export>Export</a><ul><li><a href=#export-to-csv-file>Export to CSV file</a></li><li><a href=#export-to-tsv-file>Export to TSV file</a></li></ul></li><li><a href=#import>Import</a><ul><li><a href=#import-from-csv-file>Import from CSV file</a></li><li><a href=#import-from-tsv-file>Import from TSV file</a></li></ul></li><li><a href=#trouble-shooting>Trouble Shooting</a><ul><li><a href=#how-to-change-a-port-number-of-postgresql-on-macos>How to change a port number of PostgreSQL on macOS</a></li></ul></li><li><a href=#references>References</a><ul><li><a href=#todo>TODO</a></li></ul></li></ul></nav></aside></header><ol class=breadcrumb><li><a href=https://exaream.dev/>Home</a></li><li><a href=https://exaream.dev/postgresql/>PostgreSQL</a></li><li class=active><a href=https://exaream.dev/postgresql/basic/>Basic</a></li></ol><article class=markdown><h1 id=postgresql-basic>PostgreSQL Basic
<a class=anchor href=#postgresql-basic>#</a></h1><h2 id=psql-command><code>psql</code> command
<a class=anchor href=#psql-command>#</a></h2><h3 id=usage>Usage
<a class=anchor href=#usage>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>psql <span style=color:#f92672>[</span>OPTION<span style=color:#f92672>]</span>... <span style=color:#f92672>[</span>DBNAME <span style=color:#f92672>[</span>USERNAME<span style=color:#f92672>]]</span>
</span></span></code></pre></div><p>Access DB</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ psql --host<span style=color:#f92672>=</span>sample_hostname --port<span style=color:#f92672>=</span>sample_portnumber --username<span style=color:#f92672>=</span>sampleuser sample_db
</span></span><span style=display:flex><span>or
</span></span><span style=display:flex><span>$ psql -h sample_hostname -p sample_portnumber -U sampleuser sample_db
</span></span></code></pre></div><p>Run SQL file</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ psql --file<span style=color:#f92672>=</span>/path/to/sample.sql
</span></span><span style=display:flex><span>or
</span></span><span style=display:flex><span>$ psql -f /path/to/sample.sql
</span></span></code></pre></div><p>Check Version</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ psql --version
</span></span><span style=display:flex><span>or
</span></span><span style=display:flex><span>$ psql -V
</span></span></code></pre></div><h3 id=options>Options
<a class=anchor href=#options>#</a></h3><table><thead><tr><th>option</th><th>option</th><th>description</th></tr></thead><tbody><tr><td><code>-h</code></td><td><code>--host=HOSTNAME</code></td><td>database server host or socket directory (default: &ldquo;local socket&rdquo;)</td></tr><tr><td><code>-p</code></td><td><code>--port=PORT</code></td><td>database server port (default: &ldquo;5432&rdquo;)</td></tr><tr><td><code>-U</code></td><td><code>--username=USERNAME</code></td><td>database user name (default: &ldquo;root&rdquo;)</td></tr><tr><td><code>-w</code></td><td><code>--no-password</code></td><td>never prompt for password</td></tr><tr><td><code>-W</code></td><td><code>--password</code></td><td>force password prompt (should happen automatically)</td></tr><tr><td><code>-c</code></td><td><code>--command=COMMAND</code></td><td>run only single command (SQL or internal) and exit</td></tr><tr><td><code>-d</code></td><td><code>--dbname=DBNAME</code></td><td>database name to connect to (default: &ldquo;root&rdquo;)</td></tr><tr><td><code>-f</code></td><td><code>--file=FILENAME</code></td><td>execute commands from file, then exit</td></tr><tr><td><code>-l</code></td><td><code>--list</code></td><td>list available databases, then exit</td></tr><tr><td><code>-v</code></td><td><code>--set=</code>, <code>--variable=NAME=VALUE</code></td><td>set psql variable NAME to VALUE<br>(e.g., -v ON_ERROR_STOP=1)<br></td></tr><tr><td><code>-V</code></td><td><code>--version</code></td><td>output version information, then exit</td></tr><tr><td><code>-X</code></td><td><code>--no-psqlrc</code></td><td>do not read startup file (~/.psqlrc)</td></tr><tr><td><code>-1</code> (&ldquo;one&rdquo;)</td><td><code>--single-transaction</code></td><td>execute as a single transaction (if non-interactive)</td></tr><tr><td><code>-?</code></td><td><code>--help[=options]</code></td><td>show this help, then exit</td></tr><tr><td>-</td><td><code>--help=commands</code></td><td>list backslash commands, then exit</td></tr><tr><td>-</td><td><code>--help=variables</code></td><td>list special variables, then exit</td></tr></tbody></table><h2 id=commands-using-backslash>Commands using <code>\(backslash)</code>
<a class=anchor href=#commands-using-backslash>#</a></h2><table><thead><tr><th>Command</th><th>Description</th><th>Remarks</th></tr></thead><tbody><tr><td><code>\?</code></td><td>Help</td><td>-</td></tr><tr><td><code>\l</code></td><td>Show DBs</td><td>-</td></tr><tr><td><code>\c sample_db</code></td><td>Switch DB</td><td>-</td></tr><tr><td><code>\d</code>, <code>\dt</code>, <code>\d+</code>, <code>\dt+</code></td><td>Show tables</td><td>-</td></tr><tr><td><code>\d sample_tbl</code></td><td>Describe table definition</td><td>-</td></tr><tr><td><code>\d sample_tbl</code></td><td>Show indexs</td><td>-</td></tr><tr><td><code>\x</code></td><td>Swich display mode</td><td><span class=code>\x<br>SELECT * FROM sample_tbl;</span></td></tr><tr><td><code>\i sample.sql</code></td><td>Run SQL file</td><td>-</td></tr><tr><td><code>\time on</code></td><td>Measure SQL time</td><td>-</td></tr><tr><td><code>\o sample.log</code></td><td>Begin log output</td><td>-</td></tr><tr><td><code>\o</code></td><td>End log output</td><td>-</td></tr><tr><td><code>\conninfo</code></td><td>Check server info</td><td>-</td></tr><tr><td><code>\q</code></td><td>Quit</td><td></td></tr></tbody></table><h2 id=postgresqls-info>PostgreSQL&rsquo;s Info
<a class=anchor href=#postgresqls-info>#</a></h2><h3 id=default-connection-info>Default Connection Info
<a class=anchor href=#default-connection-info>#</a></h3><ul><li>Set values of connection info as an environment variable.</li><li>Can also set the password on <code>~/.pgpass</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>export PGDATABASE<span style=color:#f92672>=</span>sample_db
</span></span><span style=display:flex><span>export PGHOST<span style=color:#f92672>=</span>sample_host
</span></span><span style=display:flex><span>export PGPORT<span style=color:#f92672>=</span>XXXX
</span></span><span style=display:flex><span>export PGUSER<span style=color:#f92672>=</span>sampleuser
</span></span><span style=display:flex><span>export PGPASSWORD<span style=color:#f92672>=</span>samplepassword
</span></span></code></pre></div><h3 id=table-list>Table List
<a class=anchor href=#table-list>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-postgresql data-lang=postgresql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  table_catalog,
</span></span><span style=display:flex><span>  table_schema,
</span></span><span style=display:flex><span>  table_name,
</span></span><span style=display:flex><span>  table_type
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span>
</span></span><span style=display:flex><span>  information_schema<span style=color:#ae81ff>.</span><span style=color:#66d9ef>tables</span>;
</span></span></code></pre></div><h3 id=column-list>Column List
<a class=anchor href=#column-list>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-postgresql data-lang=postgresql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>    col<span style=color:#ae81ff>.</span>table_name,
</span></span><span style=display:flex><span>    col<span style=color:#ae81ff>.</span>ordinal_position, <span style=color:#75715e>-- No.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    col<span style=color:#ae81ff>.</span>column_name,
</span></span><span style=display:flex><span>    col<span style=color:#ae81ff>.</span>data_type,
</span></span><span style=display:flex><span>    col<span style=color:#ae81ff>.</span>character_maximum_length, <span style=color:#75715e>-- 文字数(文字列型)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    col<span style=color:#ae81ff>.</span>character_octet_length, <span style=color:#75715e>-- バイト数(文字列型)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    col<span style=color:#ae81ff>.</span>numeric_precision, <span style=color:#75715e>-- 桁数(数値型)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    col<span style=color:#ae81ff>.</span>numeric_scale, <span style=color:#75715e>-- 小数部(数値型)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    col<span style=color:#ae81ff>.</span>datetime_precision, <span style=color:#75715e>-- ミリ秒以下(日付型)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    col<span style=color:#ae81ff>.</span>interval_type, <span style=color:#75715e>-- インターバルの単位(日付型)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    col<span style=color:#ae81ff>.</span>is_nullable, <span style=color:#75715e>-- NULLを許可するか否か
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    col<span style=color:#ae81ff>.</span>column_default <span style=color:#75715e>-- 初期値
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>FROM</span>
</span></span><span style=display:flex><span>    information_schema<span style=color:#ae81ff>.</span>columns col
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span>
</span></span><span style=display:flex><span>    col<span style=color:#ae81ff>.</span>table_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;sample_table&#39;</span> <span style=color:#75715e>-- 対象テーブル名を指定
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span>
</span></span><span style=display:flex><span>    col<span style=color:#ae81ff>.</span>table_name,
</span></span><span style=display:flex><span>    col<span style=color:#ae81ff>.</span>ordinal_position
</span></span></code></pre></div><h3 id=process-list>Process List
<a class=anchor href=#process-list>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-postgresql data-lang=postgresql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> pg_stat_activity;
</span></span></code></pre></div><h2 id=pg_dump-command><code>pg_dump</code> command
<a class=anchor href=#pg_dump-command>#</a></h2><h3 id=show-info-related-create-table-create-trigger>Show info related <code>CREATE TABLE</code>, <code>CREATE TRIGGER</code>
<a class=anchor href=#show-info-related-create-table-create-trigger>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ pg_dump sample_db -U sampleuser -s -t sample_tbl
</span></span></code></pre></div><h3 id=backup-one-db>Backup one DB
<a class=anchor href=#backup-one-db>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ pg_dump -U sampleuser --format<span style=color:#f92672>=</span>plain --file<span style=color:#f92672>=</span>/path/to/sample.sql sample_db
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ pg_dump -U sampleuser --format<span style=color:#f92672>=</span>plain sample_db &gt; /path/to/sample.sql
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ pg_dump -U sampleuser --format<span style=color:#f92672>=</span>tar --file<span style=color:#f92672>=</span>/path/to/sample.sql sample_db
</span></span></code></pre></div><h3 id=restore>Restore
<a class=anchor href=#restore>#</a></h3><ul><li>Can restore with <code>psql</code> command if the dump file is in plain text format.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ psql --file<span style=color:#f92672>=</span>/path/to/sample.sql
</span></span></code></pre></div><h2 id=pg_dumpall-command><code>pg_dumpall</code> command
<a class=anchor href=#pg_dumpall-command>#</a></h2><h3 id=backup-all-dbs>Backup all DBs
<a class=anchor href=#backup-all-dbs>#</a></h3><ul><li>All dumps are in plain text format.</li><li>Can NOT specify the format when using <code>pg_dumpall</code>.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo -i -u sampleuser
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ pg_dumpall --file all.sql
</span></span><span style=display:flex><span>or
</span></span><span style=display:flex><span>$ pg_dumpall &gt; all.sql
</span></span></code></pre></div><h2 id=explain-execution-plan><code>EXPLAIN</code> (Execution Plan)
<a class=anchor href=#explain-execution-plan>#</a></h2><ul><li>Add <code>EXPLAIN</code> before SQL</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-postgresql data-lang=postgresql><span style=display:flex><span><span style=color:#66d9ef>EXPLAIN</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> sample_tbl <span style=color:#66d9ef>WHERE</span> id <span style=color:#f92672>=</span> XXXXX;
</span></span></code></pre></div><h2 id=create-table><code>CREATE TABLE</code>
<a class=anchor href=#create-table>#</a></h2><h3 id=copy-definitions--create-table>Copy definitions & Create table
<a class=anchor href=#copy-definitions--create-table>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-postgresql data-lang=postgresql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> copy_tbl (<span style=color:#66d9ef>LIKE</span> org_tbl);
</span></span></code></pre></div><h3 id=define-id-and-timestamp>Define id and timestamp
<a class=anchor href=#define-id-and-timestamp>#</a></h3><ul><li>Use UUID as the primary key.</li></ul><h4 id=simple-version>Simple Version
<a class=anchor href=#simple-version>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-postgres data-lang=postgres><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> sample_tbl (
</span></span><span style=display:flex><span>    id UUID <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> <span style=color:#66d9ef>DEFAULT</span> gen_random_uuid(),
</span></span><span style=display:flex><span>    created_at TIMESTAMPTZ <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span>,
</span></span><span style=display:flex><span>    updated_at TIMESTAMPTZ <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span> <span style=color:#75715e>-- Update by program
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>);
</span></span></code></pre></div><h4 id=more-accurate-version>More Accurate Version
<a class=anchor href=#more-accurate-version>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-postgresql data-lang=postgresql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> sample_tbl (
</span></span><span style=display:flex><span>    id UUID <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> <span style=color:#66d9ef>DEFAULT</span> gen_random_uuid(),
</span></span><span style=display:flex><span>    created_at TIMESTAMPTZ <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span>,
</span></span><span style=display:flex><span>    updated_at TIMESTAMPTZ <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span>
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TRIGGER</span> refresh_users_updated_at_step1
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>BEFORE</span> <span style=color:#66d9ef>UPDATE</span> <span style=color:#66d9ef>ON</span> users <span style=color:#66d9ef>FOR</span> <span style=color:#66d9ef>EACH</span> <span style=color:#66d9ef>ROW</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>EXECUTE</span> <span style=color:#66d9ef>PROCEDURE</span> refresh_updated_at_step1();
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TRIGGER</span> refresh_users_updated_at_step2
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>BEFORE</span> <span style=color:#66d9ef>UPDATE</span> <span style=color:#66d9ef>OF</span> updated_at <span style=color:#66d9ef>ON</span> users <span style=color:#66d9ef>FOR</span> <span style=color:#66d9ef>EACH</span> <span style=color:#66d9ef>ROW</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>EXECUTE</span> <span style=color:#66d9ef>PROCEDURE</span> refresh_updated_at_step2();
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TRIGGER</span> refresh_users_updated_at_step3
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>BEFORE</span> <span style=color:#66d9ef>UPDATE</span> <span style=color:#66d9ef>ON</span> users <span style=color:#66d9ef>FOR</span> <span style=color:#66d9ef>EACH</span> <span style=color:#66d9ef>ROW</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>EXECUTE</span> <span style=color:#66d9ef>PROCEDURE</span> refresh_updated_at_step3();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>FUNCTION</span> refresh_updated_at_step1() <span style=color:#66d9ef>RETURNS</span> <span style=color:#66d9ef>trigger</span> <span style=color:#66d9ef>AS</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>$$</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>BEGIN</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>IF</span> NEW<span style=color:#ae81ff>.</span>updated_at <span style=color:#f92672>=</span> OLD<span style=color:#ae81ff>.</span>updated_at <span style=color:#66d9ef>THEN</span>
</span></span><span style=display:flex><span>    NEW<span style=color:#ae81ff>.</span>updated_at <span style=color:#f92672>:=</span> <span style=color:#66d9ef>NULL</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>END</span> <span style=color:#66d9ef>IF</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>RETURN</span> NEW;
</span></span><span style=display:flex><span><span style=color:#66d9ef>END</span>;
</span></span><span style=display:flex><span><span style=color:#e6db74>$$</span> <span style=color:#66d9ef>LANGUAGE</span> <span style=color:#e6db74>plpgsql</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>FUNCTION</span> refresh_updated_at_step2() <span style=color:#66d9ef>RETURNS</span> <span style=color:#66d9ef>trigger</span> <span style=color:#66d9ef>AS</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>$$</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>BEGIN</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>IF</span> NEW<span style=color:#ae81ff>.</span>updated_at <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>THEN</span>
</span></span><span style=display:flex><span>    NEW<span style=color:#ae81ff>.</span>updated_at <span style=color:#f92672>:=</span> OLD<span style=color:#ae81ff>.</span>updated_at;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>END</span> <span style=color:#66d9ef>IF</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>RETURN</span> NEW;
</span></span><span style=display:flex><span><span style=color:#66d9ef>END</span>;
</span></span><span style=display:flex><span><span style=color:#e6db74>$$</span> <span style=color:#66d9ef>LANGUAGE</span> <span style=color:#e6db74>plpgsql</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>FUNCTION</span> refresh_updated_at_step3() <span style=color:#66d9ef>RETURNS</span> <span style=color:#66d9ef>trigger</span> <span style=color:#66d9ef>AS</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>$$</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>BEGIN</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>IF</span> NEW<span style=color:#ae81ff>.</span>updated_at <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>THEN</span>
</span></span><span style=display:flex><span>    NEW<span style=color:#ae81ff>.</span>updated_at <span style=color:#f92672>:=</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>END</span> <span style=color:#66d9ef>IF</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>RETURN</span> NEW;
</span></span><span style=display:flex><span><span style=color:#66d9ef>END</span>;
</span></span><span style=display:flex><span><span style=color:#e6db74>$$</span> <span style=color:#66d9ef>LANGUAGE</span> <span style=color:#e6db74>plpgsql</span>;
</span></span></code></pre></div><h2 id=timezone>Timezone
<a class=anchor href=#timezone>#</a></h2><h3 id=check-current-timezone>Check current timezone
<a class=anchor href=#check-current-timezone>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>SHOW TIMEZONE;
</span></span></code></pre></div><h3 id=check-timezones-that-can-be-set>Check timezones that can be set
<a class=anchor href=#check-timezones-that-can-be-set>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>SELECT * FROM pg_timezone_names;
</span></span></code></pre></div><h3 id=set-new-timezone>Set new timezone
<a class=anchor href=#set-new-timezone>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ALTER DATABASE exsampledb SET timezone TO <span style=color:#e6db74>&#39;Asia/Tokyo&#39;</span>;
</span></span></code></pre></div><h3 id=apply-the-change>Apply the change
<a class=anchor href=#apply-the-change>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>SELECT pg_reload_conf<span style=color:#f92672>()</span>;
</span></span></code></pre></div><h2 id=export>Export
<a class=anchor href=#export>#</a></h2><h3 id=export-to-csv-file>Export to CSV file
<a class=anchor href=#export-to-csv-file>#</a></h3><ul><li>Use tab as a delimiter. <code>DELIMITER ','</code></li><li>Enclose all fields in quote. <code>FORCE QUOTE *</code></li><li>Output field names as header. <code>HEADER</code></li><li>Change NULL to &rsquo;&rsquo; (empty string). <code>NULL AS ''</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-postgresql data-lang=postgresql><span style=display:flex><span><span style=color:#66d9ef>COPY</span> sample_tbl <span style=color:#66d9ef>FROM</span> <span style=color:#e6db74>&#39;/absolute/path/to/sample.tsv&#39;</span> <span style=color:#66d9ef>WITH</span> <span style=color:#66d9ef>CSV</span> <span style=color:#66d9ef>DELIMITER</span> <span style=color:#e6db74>&#39;,&#39;</span> <span style=color:#66d9ef>FORCE</span> <span style=color:#66d9ef>QUOTE</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>AS</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#66d9ef>HEADER</span>;
</span></span></code></pre></div><p>or</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ psql sample_db -c <span style=color:#e6db74>&#34;SELECT * FROM sample_tbl&#34;</span> -A -F, &gt; sample.csv
</span></span></code></pre></div><h3 id=export-to-tsv-file>Export to TSV file
<a class=anchor href=#export-to-tsv-file>#</a></h3><ul><li>Use tab as a delimiter. <code>DELIMITER E'\t'</code></li><li>Enclose all fields in quote. <code>FORCE QUOTE *</code></li><li>Output field names as header. <code>HEADER</code></li><li>Change NULL to &rsquo;&rsquo; (empty string). <code>NULL AS ''</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-postgresql data-lang=postgresql><span style=display:flex><span><span style=color:#66d9ef>COPY</span> sample_tbl <span style=color:#66d9ef>FROM</span> <span style=color:#e6db74>&#39;/absolute/path/to/sample.tsv&#39;</span> <span style=color:#66d9ef>WITH</span> <span style=color:#66d9ef>CSV</span> <span style=color:#66d9ef>DELIMITER</span> <span style=color:#e6db74>E</span><span style=color:#e6db74>&#39;\t&#39;</span> <span style=color:#66d9ef>FORCE</span> <span style=color:#66d9ef>QUOTE</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>AS</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#66d9ef>HEADER</span>;
</span></span></code></pre></div><p>or</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ psql sample_db -c <span style=color:#e6db74>&#34;SELECT * FROM sample_tbl&#34;</span> -A -F <span style=color:#e6db74>$&#39;\t&#39;</span> &gt; sample.tsv
</span></span></code></pre></div><h2 id=import>Import
<a class=anchor href=#import>#</a></h2><h3 id=import-from-csv-file>Import from CSV file
<a class=anchor href=#import-from-csv-file>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-postgresql data-lang=postgresql><span style=display:flex><span><span style=color:#66d9ef>COPY</span> sample_tbl <span style=color:#66d9ef>FROM</span> <span style=color:#e6db74>&#39;/absolute/path/to/sample.tsv&#39;</span> <span style=color:#66d9ef>WITH</span> <span style=color:#66d9ef>CSV</span> <span style=color:#66d9ef>DELIMITER</span> <span style=color:#e6db74>&#39;,&#39;</span>;
</span></span></code></pre></div><h3 id=import-from-tsv-file>Import from TSV file
<a class=anchor href=#import-from-tsv-file>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-postgresql data-lang=postgresql><span style=display:flex><span><span style=color:#66d9ef>COPY</span> sample_tbl <span style=color:#66d9ef>FROM</span> <span style=color:#e6db74>&#39;/absolute/path/to/sample.tsv&#39;</span> WITHC <span style=color:#66d9ef>CSV</span> <span style=color:#66d9ef>DELIMITER</span> <span style=color:#e6db74>E</span><span style=color:#e6db74>&#39;\t&#39;</span>;
</span></span></code></pre></div><h2 id=trouble-shooting>Trouble Shooting
<a class=anchor href=#trouble-shooting>#</a></h2><h3 id=how-to-change-a-port-number-of-postgresql-on-macos>How to change a port number of PostgreSQL on macOS
<a class=anchor href=#how-to-change-a-port-number-of-postgresql-on-macos>#</a></h3><p>Change the port number of PostgreSQL.<br>(Change the version number 13 to your PostgreSQL version in the following command.)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo vi Library/PostgreSQL/13/data/postgresql.conf
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>port <span style=color:#f92672>=</span> <span style=color:#ae81ff>5432</span>                             <span style=color:#75715e># (change requires restart)</span>
</span></span><span style=display:flex><span>↓
</span></span><span style=display:flex><span>port <span style=color:#f92672>=</span> <span style=color:#ae81ff>5433</span>                             <span style=color:#75715e># (change requires restart)</span>
</span></span></code></pre></div><p>Restart PostgreSQL.<br>(Change the version number 13 to your PostgreSQL version in the following command.)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo launchctl stop com.edb.launchd.postgresql-13
</span></span><span style=display:flex><span>$ sudo launchctl start com.edb.launchd.postgresql-13
</span></span></code></pre></div><h2 id=references>References
<a class=anchor href=#references>#</a></h2><ul><li><a href=https://www.postgresql.org/docs/current>PostgreSQL Documentation</a></li><li><a href=https://www.postgresql.jp/document/current/html>PostgreSQL Documentation(Japanese)</a></li><li><a href=https://www.postgresql.jp/document/current/html/datatype.html>PostgreSQL データ型</a></li><li><a href=https://www.postgresql.org/docs/14/monitoring-stats.html>PostgreSQL: Documentation: 14: 28.2. The Statistics Collector</a></li><li><a href=https://zenn.dev/mpyw/articles/rdb-ids-and-timestamps-best-practices>Postgres と MySQL における id, created_at, updated_at に関するベストプラクティス</a></li><li><a href=https://qiita.com/aosho235/items/c657e2fcd15fa0647471>MySQLとPostgreSQLコマンド比較表</a></li><li><a href=https://qiita.com/zkangaroo/items/93be2d4504c3d1d5f185>PostgreSQL - タイムゾーンをDBに設定する</a></li></ul><h3 id=todo>TODO
<a class=anchor href=#todo>#</a></h3><ul><li><a href=https://www.kimullaa.com/entry/2020/03/14/134232>PostgreSQL Isolation について</a></li><li><a href=https://blog.serverworks.co.jp/postgres_jsonb_search>【PostgreSQL】 jsonb型カラムをSQLで検索・集計したい</a></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><h2>Tags</h2><ul class=tags><li><a href=/tags/postgresql>PostgreSQL</a><li><a href=/tags/sql>SQL</a></ul><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#psql-command><code>psql</code> command</a><ul><li><a href=#usage>Usage</a></li><li><a href=#options>Options</a></li></ul></li><li><a href=#commands-using-backslash>Commands using <code>\(backslash)</code></a></li><li><a href=#postgresqls-info>PostgreSQL&rsquo;s Info</a><ul><li><a href=#default-connection-info>Default Connection Info</a></li><li><a href=#table-list>Table List</a></li><li><a href=#column-list>Column List</a></li><li><a href=#process-list>Process List</a></li></ul></li><li><a href=#pg_dump-command><code>pg_dump</code> command</a><ul><li><a href=#show-info-related-create-table-create-trigger>Show info related <code>CREATE TABLE</code>, <code>CREATE TRIGGER</code></a></li><li><a href=#backup-one-db>Backup one DB</a></li><li><a href=#restore>Restore</a></li></ul></li><li><a href=#pg_dumpall-command><code>pg_dumpall</code> command</a><ul><li><a href=#backup-all-dbs>Backup all DBs</a></li></ul></li><li><a href=#explain-execution-plan><code>EXPLAIN</code> (Execution Plan)</a></li><li><a href=#create-table><code>CREATE TABLE</code></a><ul><li><a href=#copy-definitions--create-table>Copy definitions & Create table</a></li><li><a href=#define-id-and-timestamp>Define id and timestamp</a></li></ul></li><li><a href=#timezone>Timezone</a><ul><li><a href=#check-current-timezone>Check current timezone</a></li><li><a href=#check-timezones-that-can-be-set>Check timezones that can be set</a></li><li><a href=#set-new-timezone>Set new timezone</a></li><li><a href=#apply-the-change>Apply the change</a></li></ul></li><li><a href=#export>Export</a><ul><li><a href=#export-to-csv-file>Export to CSV file</a></li><li><a href=#export-to-tsv-file>Export to TSV file</a></li></ul></li><li><a href=#import>Import</a><ul><li><a href=#import-from-csv-file>Import from CSV file</a></li><li><a href=#import-from-tsv-file>Import from TSV file</a></li></ul></li><li><a href=#trouble-shooting>Trouble Shooting</a><ul><li><a href=#how-to-change-a-port-number-of-postgresql-on-macos>How to change a port number of PostgreSQL on macOS</a></li></ul></li><li><a href=#references>References</a><ul><li><a href=#todo>TODO</a></li></ul></li></ul></nav></div></aside></main></body></html>